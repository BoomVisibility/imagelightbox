!function(t,n,e,i){"use strict";var o={home:{href:n.location.pathname,title:e.title},pushSpace:{name:"#!imagelightbox/",title:"ImageLightBox"},spacer:" | "},a=function(){var t=e.body||e.documentElement;return t=t.style,""===t.WebkitTransition?"-webkit-":""===t.MozTransition?"-moz-":""===t.OTransition?"-o-":""===t.transition?"":!1},r=a()!==!1,c=function(t,n,e){var i={},o=a();i[o+"transform"]="translateX("+n+")",i[o+"transition"]=o+"transform "+e+"s linear",t.css(i)},u="ontouchstart"in n,l=n.navigator.pointerEnabled||n.navigator.msPointerEnabled,s=function(t){if(u)return!0;if(!l||"undefined"==typeof t||"undefined"==typeof t.pointerType)return!1;if("undefined"!=typeof t.MSPOINTER_TYPE_MOUSE){if(t.MSPOINTER_TYPE_MOUSE!==t.pointerType)return!0}else if("mouse"!==t.pointerType)return!0;return!1};t.fn.imageLightbox=function(a){var g=t.extend({selector:"a[data-imagelightbox]",id:"imagelightbox",allowedTypes:"png|jpg|jpeg||gif",animationSpeed:250,activity:!1,arrows:!1,button:!1,caption:!1,enableKeyboard:!0,history:!1,navigation:!1,overlay:!1,preloadNext:!0,quitOnEnd:!1,quitOnImgClick:!1,quitOnDocClick:!0,quitOnEscKey:!0,onStart:function(){g.arrows&&T(this),g.navigation&&y(this,g.selector),g.overlay&&h(),g.button&&v()},onEnd:function(){g.activity&&f(),g.arrows&&k(),g.navigation&&E(),g.overlay&&p(),g.caption&&b(),g.button&&m()},onLoadStart:function(){g.activity&&d(),g.caption&&b()},onLoadEnd:function(){g.activity&&f(),g.arrows&&t(".imagelightbox-arrow").css("display","block"),g.navigation&&S(g.selector),g.caption&&x()},previousTarget:function(){return this.previousTargetDefault()},previousTargetDefault:function(){var t=q.index(w)-1;if(M&&(console.log("current index is "+t),n.history.pushState({index:t},"",o.pushSpace.name+(t+1))),0>t){if(g.quitOnEnd===!0)return z(),!1;t=q.length-1}w=q.eq(t)},nextTarget:function(){return this.nextTargetDefault()},nextTargetDefault:function(){var t=q.index(w)+1;if(M&&(console.log("current index is "+t),n.history.pushState({index:t},"",o.pushSpace.name+(t+1))),t>=q.length){if(g.quitOnEnd===!0)return z(),!1;t=0}w=q.eq(t)}},a),d=function(){t('<div id="imagelightbox-loading"><div></div></div>').appendTo("body")},f=function(){t("#imagelightbox-loading").remove()},h=function(){t('<div id="imagelightbox-overlay"></div>').appendTo("body")},p=function(){t("#imagelightbox-overlay").remove()},v=function(){t('<a href="#" id="imagelightbox-close"></a>').appendTo("body").on("click.imagelightbox",function(){return t(this).remove(),z(),!1})},m=function(){t("#imagelightbox-close").remove()},x=function(){var n=t(w).find("img").attr("alt");n&&n.length>0&&t('<div id="imagelightbox-caption">'+n+"</div>").appendTo("body")},b=function(){t("#imagelightbox-caption").remove()},y=function(e,i){var a=t(i);if(a.length){for(var r=t('<div id="imagelightbox-nav"></div>'),c=0;c<a.length;c++)r.append('<a href="#"></a>');r.appendTo("body"),r.on("click touchend",function(){return!1});var u=r.find("a");u.on("click touchend",function(){var e=t(this);if(a.eq(e.index()).attr("href")!==t("#imagelightbox").attr("src")){var i=q.eq(e.index()),r=e.index()+1;if(M&&(console.log("navigation index is "+r),n.history.pushState({index:e.index()},"",o.pushSpace.name+r)),i.length){var c=q.index(w);w=i,X(e.index()<c?"left":"right")}}return u.removeClass("active"),u.eq(e.index()).addClass("active"),!1}).on("touchend",function(){return!1})}},S=function(n){var e=t("#imagelightbox-nav").find("a");e.removeClass("active"),e.eq(t(n).filter('[href="'+t("#imagelightbox").attr("src")+'"]').index(n)).addClass("active")},E=function(){t("#imagelightbox-nav").remove()},T=function(n){var e=t('<button type="button" class="imagelightbox-arrow imagelightbox-arrow-left"></button><button type="button" class="imagelightbox-arrow imagelightbox-arrow-right"></button>');e.appendTo("body"),e.on("click touchend",function(e){return e.preventDefault(),t(this).hasClass("imagelightbox-arrow-left")?N(n):K(n),!1})},k=function(){t(".imagelightbox-arrow").remove()},q=t([]),w=t(),I=t(),O=0,C=0,L=0,D=!1,M=!(n.history.pushState===i||!g.history),P=function(){if(!I.length)return!0;var e=.8*t(n).width(),i=n.innerHeight?n.innerHeight:t(n).height(),o=.9*i,a=new Image;a.src=I.attr("src"),a.onload=function(){if(O=a.width,C=a.height,O>e||C>o){var r=O/C>e/o?O/e:C/o;O/=r,C/=r}I.css({width:O+"px",height:C+"px",top:(i-C)/2+"px",left:(t(n).width()-O)/2+"px"})}},X=function(i){if(D)return!1;if(i="undefined"==typeof i?!1:"left"===i?1:-1,I.length){var a={opacity:0};r?c(I,100*i-L+"px",g.animationSpeed/1e3):a.left=parseInt(I.css("left"))+100*i+"px",I.animate(a,g.animationSpeed,function(){U()}),L=0}D=!0,g.onLoadStart!==!1&&g.onLoadStart(),n.setTimeout(function(){var n=(q.index(w),w.attr("href")),a=n.split("/").pop();M&&(e.title=o.home.title+o.spacer+o.pushSpace.title+o.spacer+a),I=t('<img id="'+g.id+'" />').attr("src",n).on("load",function(){var n={opacity:1};if(I.appendTo("body"),P(),I.css("opacity",0),r)c(I,-100*i+"px",0),setTimeout(function(){c(I,"0px",g.animationSpeed/1e3)},50);else{var e=parseInt(I.css("left"));n.left=e+"px",I.css("left",e-100*i+"px")}if(I.animate(n,g.animationSpeed,function(){D=!1,g.onLoadEnd!==!1&&g.onLoadEnd()}),g.preloadNext){var o=q.eq(q.index(w)+1);o.length||(o=q.eq(0)),t("<img />").attr("src",o.attr("href"))}}).on("error",function(){g.onLoadEnd!==!1&&g.onLoadEnd()});var u=0,d=0,f=0;I.on(l?"pointerup MSPointerUp":"click",function(t){if(t.preventDefault(),g.quitOnImgClick)return z(),!1;if(s(t.originalEvent))return!0;var n=(t.pageX||t.originalEvent.pageX)-t.target.offsetLeft;O/2>n?N():K()}).on("touchstart pointerdown MSPointerDown",function(t){return!s(t.originalEvent)||g.quitOnImgClick?!0:(r&&(f=parseInt(I.css("left"))),void(u=t.originalEvent.pageX||t.originalEvent.touches[0].pageX))}).on("touchmove pointermove MSPointerMove",function(t){return!s(t.originalEvent)||g.quitOnImgClick?!0:(t.preventDefault(),d=t.originalEvent.pageX||t.originalEvent.touches[0].pageX,L=u-d,void(r?c(I,-L+"px",0):I.css("left",f-L+"px")))}).on("touchend touchcancel pointerup pointercancel MSPointerUp MSPointerCancel",function(t){return!s(t.originalEvent)||g.quitOnImgClick?!0:void(Math.abs(L)>50?0>L?N():K():r?c(I,"0px",g.animationSpeed/1e3):I.animate({left:f+"px"},g.animationSpeed/2))})},g.animationSpeed+100)},N=function(){g.previousTarget()!==!1&&X("left")},K=function(){g.nextTarget()!==!1&&X("right")},U=function(){return I.length?(I.remove(),void(I=t())):!1},_=function(){console.log(w);var t=q.index(w);M&&n.history.pushState({index:t},"",o.pushSpace.name+(t+1))},j=function(t){return D?!1:(D=!1,g.onStart!==!1&&g.onStart(),w=t,void X())},z=function(){return M&&(n.history.pushState("","",o.home.href),e.title=o.home.title),I.length?(I.animate({opacity:0},g.animationSpeed,function(){U(),D=!1,g.onEnd!==!1&&g.onEnd()}),void t(n,e).off(".imagelightbox")):!1},B=function(n){console.log("adding targets"),n.each(function(){q=q.add(t(this))}),n.on("click",function(n){n.preventDefault(),j(t(this))})};return this.startImageLightbox=function(){this.length>0&&j(t(this[0]))},t(n).on("resize.imagelightBox",P).on("popstate",function(n){var e=n.originalEvent.state.index;console.log("popIndex is "+e),e===i?z():(w=q.eq(e),console.log(t(w)),X())}),t(e).ready(function(){g.quitOnDocClick&&t(e).on(u?"touchend":"click",function(n){I.length&&!t(n.target).is(I)&&(n.preventDefault(),z())}),g.enableKeyboard&&t(e).on("keyup",function(t){return I.length?(t.preventDefault(),27===t.keyCode&&g.quitOnEscKey===!0&&z(),void(37===t.keyCode?N():39===t.keyCode&&K())):!0})}),t(e).off("click.imagelightbox",this.selector).on("click.imagelightbox",this.selector,function(t){t.preventDefault(),_()}).ready(function(){n.history.replaceState(null,null,o.home.href)}),B(t(this)),this.loadPreviousImage=function(){N()},this.loadNextImage=function(){K()},this.quitImageLightbox=function(){return z(),this},this.startImageLightbox=function(){_()},this.addToImageLightbox=function(t){B(t)},this}}(jQuery,window,document);